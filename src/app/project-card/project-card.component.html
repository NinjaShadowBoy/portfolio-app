<article class="project-card" [class.featured]="project.featured">
  @if (project.featured) {
  <div class="featured-badge">Featured</div>
  }

  <header class="project-header">
    <h3>{{ project.name }}</h3>
    <div class="project-meta">
      <span class="created-date">Created: {{ project.createdAt | date:'MMM yyyy' }}</span>
      @if (project.updatedAt.toString() !== project.createdAt.toString()) {
      <span class="updated-date">Updated: {{ project.updatedAt | date:'MMM yyyy' }}</span>
      }
    </div>
  </header>

  <div class="project-content">
    <p class="project-description">{{ project.description }}</p>

    <div class="technologies">
      <strong>Technologies:</strong>
      <div class="tech-tags">
        @for (tech of project.technologies; track tech) {
        <span class="tech-tag">{{ tech }}</span>
        }
      </div>
    </div>

    <div class="rating-section">
      <div class="rating-display">
        <span class="rating-label">Rating:</span>
        <div class="stars">
          @for (star of getStarArray(project.averageRating); track star) {
          <span class="star" [class]="getRatingClass(star, project.averageRating)">★</span>
          }
        </div>
        <span class="rating-text">
          {{ project.averageRating.toFixed(1) }}
          ({{ project.totalRatings }} rating{{ project.totalRatings !== 1 ? 's' : '' }})
        </span>
      </div>

      @if (canRate) {
      <div class="rating-input">
        <span>Rate this project:</span>
        <div class="rating-buttons">
          @for (star of getStarArray(5); track star) {
          <button (click)="onAddRating(star)" class="rating-button"
            [attr.aria-label]="'Rate ' + star + ' star' + (star !== 1 ? 's' : '')">
            {{ star }}★
          </button>
          }
        </div>
      </div>
      } @else {
      <p class="already-rated">You've already rated this project</p>
      }
    </div>

    <div class="project-actions">
      <app-cta-button
        text="Details"
        [routerLink]="['/projects', project.id]"
        icon="search"
        variant="outline">
      </app-cta-button>
      <a [href]="project.githubLink" target="_blank" rel="noopener noreferrer" class="github-link" aria-label="View on GitHub">
        <img src="assets/icons/github.svg" alt="GitHub" width="20" height="20" class="github-icon" />
      </a>
      <button (click)="onToggleDetails()" class="details-toggle">
        {{ project.isExpanded ? 'Hide Summary' : 'Summary' }}
      </button>
      @if (isAdmin) {
      <button (click)="onResetRatings()" class="reset-ratings">
        Reset Ratings
      </button>
      }
    </div>

    @if (project.isExpanded) {
    <div class="project-details">
      <div class="detail-section">
        <h4>Challenges:</h4>
        <p>{{ project.challenges }}</p>
      </div>
      <div class="detail-section">
        <h4>What I Learned:</h4>
        <p>{{ project.whatILearned }}</p>
      </div>
      @if (project.totalRatings > 0) {
      <div class="detail-section">
        <h4>Ratings Summary:</h4>
        <p>This project has {{ project.totalRatings }} rating{{ project.totalRatings !== 1 ? 's' : '' }} with an average of {{ project.averageRating.toFixed(1) }} stars.</p>
      </div>
      }
    </div>
    }
  </div>
</article>
